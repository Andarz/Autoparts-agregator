{% extends "base.html" %}

{% block content %}
<div class="d-flex flex-column justify-content-center align-items-center" style="min-height: 80vh;">

    <div class="main-container text-center w-100 p-5 shadow-lg" style="max-width: 700px; background: white; border-radius: 20px;">
        
        <div class="mb-4 display-1">üöô</div>
        <h2 class="mb-4 fw-bold text-secondary">–ü–æ–∏—Å–∫ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–µ–π</h2>
        
        <!-- –î–æ–±–∞–≤–∏–ª–∏ onsubmit="saveSearchTerm()" -->
        <form action="/search" method="post" onsubmit="saveSearchTerm()">
            <div class="input-group input-group-lg mb-4 shadow-sm">
                <!-- 
                     1. –î–æ–±–∞–≤–∏–ª–∏ id="searchInput" —á—Ç–æ–±—ã JS –º–æ–≥ –Ω–∞–π—Ç–∏ —ç—Ç–æ –ø–æ–ª–µ 
                     2. –î–æ–±–∞–≤–∏–ª–∏ list="historyOptions" –¥–ª—è —Å–≤—è–∑–∏ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º —Å–ø–∏—Å–∫–æ–º
                     3. autocomplete="off" —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–æ–Ω–∏ –º–µ—à–∞—é—Ç –Ω–∞—à–µ–º—É —Å–ø–∏—Å–∫—É)
                -->
                <input type="text" 
                       id="searchInput"
                       name="part_code" 
                       class="form-control border-secondary-subtle" 
                       placeholder="–ù–æ–º–µ—Ä –¥–µ—Ç–∞–ª–∏ (–Ω–∞–ø—Ä. W712/95)..." 
                       list="historyOptions" 
                       autocomplete="off"
                       required autofocus>
                
                <!-- –°–∞–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—É—Å—Ç–æ–π, –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º) -->
                <datalist id="historyOptions"></datalist>

                <button class="btn btn-primary px-5 fw-bold" type="submit">–ù–ê–ô–¢–ò</button>
            </div>
            
            <div class="text-muted small">
                ‚ö° –ü–æ–∏—Å–∫ –ø–æ —Å–∫–ª–∞–¥–∞–º: <span class="badge bg-light text-dark border">InterCars</span> <span class="badge bg-light text-dark border">–ú–µ—Å—Ç–Ω—ã–µ</span>
            </div>
        </form>

    </div>

</div>

<!-- –ú–ê–ì–ò–Ø JAVASCRIPT -->
<script>
    // –ò–º—è –∫–ª—é—á–∞ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞
    const STORAGE_KEY = 'autoparts_search_history';

    // 1. –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener("DOMContentLoaded", function() {
        const input = document.getElementById('searchInput');
        const dataList = document.getElementById('historyOptions');
        
        // –î–æ—Å—Ç–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –º–∞—Å—Å–∏–≤ (–∏–ª–∏ –±–µ—Ä–µ–º –ø—É—Å—Ç–æ–π, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç)
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // –°–æ–∑–¥–∞–µ–º –ø—É–Ω–∫—Ç—ã –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        history.forEach(term => {
            let option = document.createElement('option');
            option.value = term;
            dataList.appendChild(option);
        });
    });

    // 2. –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (—Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ù–ê–ô–¢–ò)
    function saveSearchTerm() {
        const input = document.getElementById('searchInput');
        const term = input.value.trim(); // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

        if (!term) return;

        // –î–æ—Å—Ç–∞–µ–º —Ç–µ–∫—É—â—É—é –∏—Å—Ç–æ—Ä–∏—é
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

        // –£–¥–∞–ª—è–µ–º —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –±—ã–ª –≤ —Å–ø–∏—Å–∫–µ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥—É–±–ª–µ–π –∏ –æ–Ω –ø–æ–¥–Ω—è–ª—Å—è –Ω–∞–≤–µ—Ä—Ö)
        history = history.filter(item => item !== term);

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ –ù–ê–ß–ê–õ–û —Å–ø–∏—Å–∫–∞ (unshift)
        history.unshift(term);

        // –û—Ç—Ä–µ–∑–∞–µ–º –ª–∏—à–Ω–µ–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 10 —à—Ç—É–∫
        if (history.length > 10) {
            history = history.slice(0, 10);
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–∞–º—è—Ç—å
        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
    }
</script>
{% endblock %}